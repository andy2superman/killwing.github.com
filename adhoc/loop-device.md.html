<!DOCTYPE html>
<html>
<title>Loop Device</title>
<xmp theme="united" style="display:none;">
Loop Device设备指映射正常的文件而形成的虚拟块设备。

生成初始化为0的1G文件：(自动稀疏？)
`dd if=/dev/zero of=vdisk bs=1M count=1000`

使用[稀疏文件](http://en.wikipedia.org/wiki/Sparse_file)：
`dd if=/dev/zero of=vdisk bs=1M seek=1000 count=0`

`du -h vdisk` 查看实际占用空间。

格式化：
`mkfs.ext4 vdisk`

挂载：
`mount vdisk vdir`
mount会自动关联可用的loop device（umount自动取消关联），`losetup -a`查看。
指定关联：`mount vdisk vdir -o loop=/dev/loop0`
手动关联：`losetup /dev/loop0 vdisk`
取消关联：`losetup -d /dev/loop0`
默认最多使用8个loop device，改上限`/etc/modprobe.conf`里的`options loop max_loop=15`，使生效`modprobe -v loop`。

</xmp>
<script src="../js/strapdown.js"></script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=AM_HTMLorMML-full"></script>
</html>
